{
    "id": "9667552",
    "revid": "15996738",
    "url": "https://en.wikipedia.org/wiki?curid=9667552",
    "title": "Periodic boundary conditions",
    "text": "Periodic boundary condition (PBCs) are a set of &lt;a href=\"boundary%20condition\"&gt;boundary condition&lt;/a&gt;s which are often chosen for approximating a large (infinite) system by using a small part called a \"unit cell\". PBCs are often used in &lt;a href=\"computer%20simulation\"&gt;computer simulation&lt;/a&gt;s and &lt;a href=\"mathematical%20model\"&gt;mathematical model&lt;/a&gt;s. The &lt;a href=\"topology\"&gt;topology&lt;/a&gt; of two-dimensional PBC is equal to that of a \"world map\" of some video games; the geometry of the unit cell satisfies perfect two-dimensional tiling, and when an object passes through one side of the unit cell, it re-appears on the opposite side with the same velocity. In topological terms, the space made by two-dimensional PBCs can be thought of as being mapped onto a &lt;a href=\"torus\"&gt;torus&lt;/a&gt; (&lt;a href=\"Compactification%20%28mathematics%29\"&gt;compactification&lt;/a&gt;). The large systems approximated by PBCs consist of an infinite number of unit cells. In computer simulations, one of these is the original simulation box, and others are copies called \"images\". During the simulation, only the properties of the original simulation box need to be recorded and propagated. The \"minimum-image convention\" is a common form of PBC particle bookkeeping in which each individual particle in the simulation interacts with the closest image of the remaining particles in the system.\nOne example of periodic boundary conditions can be defined according to smooth real functions formula_1 by\nfor all m = 0, 1, 2, ... and for constants formula_6 and formula_7.\nIn &lt;a href=\"molecular%20dynamics\"&gt;molecular dynamics&lt;/a&gt; simulations, PBC are usually applied to calculate properties of bulk gasses, liquids, crystals or mixtures. A common application uses PBC to simulate solvated &lt;a href=\"macromolecule\"&gt;macromolecule&lt;/a&gt;s in a bath of &lt;a href=\"water%20model\"&gt;explicit solvent&lt;/a&gt;. &lt;a href=\"Born%E2%80%93von%20Karman%20boundary%20condition\"&gt;Born\u2013von Karman boundary condition&lt;/a&gt;s are periodic boundary conditions for a special system.\nIn electromagnetics, PBC can be applied for different mesh types to analyze the electromagnetic properties of periodical structures.\nRequirements and artifacts.\nThree-dimensional PBCs are useful for approximating the behavior of macro-scale systems of gases, liquids, and solids. Three-dimensional PBCs can also be used to simulate planar surfaces, in which case two-dimensional PBCs are often more suitable. Two-dimensional PBCs for planar surfaces are also called \"slab boundary conditions\"; in this case, PBCs are used for two Cartesian coordinates (e.g., x and y), and the third coordinate (z) extends to infinity.\nPBCs can be used in conjunction with &lt;a href=\"Ewald%20summation\"&gt;Ewald summation&lt;/a&gt; methods (e.g., the particle mesh Ewald method) to calculate &lt;a href=\"Coulomb%27s%20law\"&gt;electrostatic&lt;/a&gt; forces in the system. However, PBCs also introduce correlational artifacts that do not respect the translational invariance of the system, and requires constraints on the composition and size of the simulation box.\nIn simulations of solid systems, the &lt;a href=\"strain%20%28materials%20science%29\"&gt;strain&lt;/a&gt; field arising from any inhomogeneity in the system will be artificially truncated and modified by the periodic boundary. Similarly, the wavelength of sound or shock waves and &lt;a href=\"phonon\"&gt;phonon&lt;/a&gt;s in the system is limited by the box size.\nIn simulations containing ionic (Coulomb) interactions, the net &lt;a href=\"electrostatic%20charge\"&gt;electrostatic charge&lt;/a&gt; of the system must be zero to avoid summing to an infinite charge when PBCs are applied. In some applications it is appropriate to obtain neutrality by adding &lt;a href=\"ion\"&gt;ion&lt;/a&gt;s such as &lt;a href=\"sodium\"&gt;sodium&lt;/a&gt; or &lt;a href=\"chloride\"&gt;chloride&lt;/a&gt; (as &lt;a href=\"counterion\"&gt;counterion&lt;/a&gt;s) in appropriate numbers if the molecules of interest are charged. Sometimes ions are even added to a system in which the molecules of interest are neutral, to approximate the &lt;a href=\"ionic%20strength\"&gt;ionic strength&lt;/a&gt; of the solution in which the molecules naturally appear. Maintenance of the minimum-image convention also generally requires that a spherical cutoff radius for nonbonded forces be at most half the length of one side of a cubic box. Even in electrostatically neutral systems, a net &lt;a href=\"Dipoles%23Molecular%20dipoles\"&gt;dipole moment&lt;/a&gt; of the unit cell can introduce a spurious bulk-surface energy, equivalent to &lt;a href=\"pyroelectricity\"&gt;pyroelectricity&lt;/a&gt; in &lt;a href=\"ferroelectricity\"&gt;polar crystals&lt;/a&gt;.\nThe size of the simulation box must also be large enough to prevent periodic artifacts from occurring due to the unphysical topology of the simulation. In a box that is too small, a macromolecule may interact with its own image in a neighboring box, which is functionally equivalent to a molecule's \"head\" interacting with its own \"tail\". This produces highly unphysical dynamics in most macromolecules, although the magnitude of the consequences and thus the appropriate box size relative to the size of the macromolecules depends on the intended length of the simulation, the desired accuracy, and the anticipated dynamics. For example, simulations of &lt;a href=\"protein%20folding\"&gt;protein folding&lt;/a&gt; that begin from the &lt;a href=\"native%20state\"&gt;native state&lt;/a&gt; may undergo smaller fluctuations, and therefore may not require as large a box, as simulations that begin from a &lt;a href=\"random%20coil\"&gt;random coil&lt;/a&gt; conformation. However, the effects of &lt;a href=\"solvation%20shell\"&gt;solvation shell&lt;/a&gt;s on the observed dynamics \u2013 in simulation or in experiment \u2013 are not well understood. A common recommendation based on simulations of &lt;a href=\"DNA\"&gt;DNA&lt;/a&gt; is to require at least 1\u00a0nm of solvent around the molecules of interest in every dimension.\nPractical implementation: continuity and the minimum image convention.\nAn object which has passed through one face of the simulation box should re-enter through the opposite face\u2014or its image should do it. Evidently, a strategic decision must be made: Do we (A) \u201cfold back\u201d particles into the simulation box when they leave it, or do we (B) let them go on (but compute interactions with the nearest images)? The decision has no effect on the course of the simulation, but if the user is interested in mean displacements, diffusion lengths, etc., the second option is preferable.\n(A) Restrict particle coordinates to the simulation box.\nTo implement a PBC algorithm, at least two steps are needed.\nRestricting the coordinates is a simple operation which can be described with the following code, where x_size is the length of the box in one direction (assuming an orthogonal unit cell centered on the origin) and x is the position of the particle in the same direction:\nif (periodic_x) then\n if (x &lt; -x_size * 0.5) x = x + x_size\n if (x &gt;= x_size * 0.5) x = x - x_size\nend if\nDistance and vector between objects should obey the minimum image criterion.\nThis can be implemented according to the following code (in the case of a one-dimensional system where dx is the distance direction vector from object i to object j):\nif (periodic_x) then\n dx = x(j) - x(i)\n if (dx &gt; x_size * 0.5) dx = dx - x_size\n if (dx &lt;= -x_size * 0.5) dx = dx + x_size\nend if\nFor three-dimensional PBCs, both operations should be repeated in all 3 dimensions.\nThese operations can be written in a much more compact form for &lt;a href=\"orthorhombic\"&gt;orthorhombic&lt;/a&gt; cells if the origin is shifted to a corner of the box. Then we have, in one dimension, for positions and distances respectively:\n! After x(i) update without regard to PBC:\nx(i) = x(i) - floor(x(i) / x_size) * x_size ! For a box with the origin at the lower left vertex\n! Works for x's lying in any image.\ndx = x(j) - x(i)\ndx = dx - nint(dx / x_size) * x_size\n(B) Do not restrict the particle coordinates.\nAssuming an orthorhombic simulation box with the origin at the lower left forward corner, the minimum image convention for the calculation of effective particle distances can be calculated with the \u201cnearest integer\u201c function as shown above, here as C/C++ code:\nx_rsize = 1.0 / x_size; // compute only when box size is set or changed\ndx = x[j] - x[i];\ndx -= x_size * nearbyint(dx * x_rsize);\nThe fastest way of carrying out this operation depends on the processor architecture. If the sign of dx is not relevant, the method\ndx = fabs(dx);\ndx -= static_cast&lt;int&gt;(dx * x_rsize + 0.5) * x_size;\nwas found to be fastest on x86-64 processors in 2013.\nFor non-orthorhombic cells the situation is more complicated.\nIn simulations of ionic systems more complicated operations\nmay be needed to handle the long-range Coulomb interactions spanning several box images, for instance &lt;a href=\"Ewald%20summation\"&gt;Ewald summation&lt;/a&gt;.\nUnit cell geometries.\nPBC requires the unit cell to be a shape that will tile perfectly into a three-dimensional crystal. Thus, a spherical or elliptical droplet cannot be used. A &lt;a href=\"cube\"&gt;cube&lt;/a&gt; or &lt;a href=\"rectangular%20prism\"&gt;rectangular prism&lt;/a&gt; is the most intuitive and common choice, but can be computationally expensive due to unnecessary amounts of &lt;a href=\"solvent\"&gt;solvent&lt;/a&gt; molecules in the corners, distant from the central macromolecules. A common alternative that requires less volume is the &lt;a href=\"truncated%20octahedron\"&gt;truncated octahedron&lt;/a&gt;.\nGeneral dimension.\nFor simulations in 2D and 3D space, cubic periodic boundary condition is most commonly used since it is simplest in coding. In computer simulation of high dimensional systems, however, the &lt;a href=\"Hypercube\"&gt;hypercubic&lt;/a&gt; periodic boundary condition can be less efficient because corners occupy most part of the space. In general dimension, unit cell can be viewed as the &lt;a href=\"Wigner-Seitz%20cell\"&gt;Wigner-Seitz cell&lt;/a&gt; of certain &lt;a href=\"lattice%20packing\"&gt;lattice packing&lt;/a&gt;. For example, the hypercubic periodic boundary condition corresponds to the hypercubic lattice packing. It is then preferred to choose a unit cell which corresponds to the &lt;a href=\"Close-packing%20of%20equal%20spheres\"&gt;dense packing&lt;/a&gt; of that dimension. In 4D this is &lt;a href=\"16-cell%20honeycomb\"&gt;D4 lattice&lt;/a&gt;; and &lt;a href=\"E8%20lattice\"&gt;E8 lattice&lt;/a&gt; in 8-dimension. The implementation of these high dimensional periodic boundary conditions is equivalent to &lt;a href=\"error%20correction%20code\"&gt;error correction code&lt;/a&gt; approaches in &lt;a href=\"information%20theory\"&gt;information theory&lt;/a&gt;.\nConserved properties.\nUnder periodic boundary conditions, the linear &lt;a href=\"momentum\"&gt;momentum&lt;/a&gt; of the system is conserved, but &lt;a href=\"Angular%20momentum\"&gt;Angular momentum&lt;/a&gt; is not. Conventional explanation of this fact is based on &lt;a href=\"Noether%27s%20theorem\"&gt;Noether's theorem&lt;/a&gt;, which states that conservation of angular momentum follows from rotational invariance of &lt;a href=\"Lagrangian%20mechanics\"&gt;Lagrangian&lt;/a&gt;. However, this approach was shown to not be consistent: it fails to explain the absence of conservation of angular momentum of a single particle moving in a periodic cell. Lagrangian of the particle is constant and therefore rotationally invariant, while angular momentum of the particle is not conserved. This contradiction is caused by the fact that Noether's theorem is usually formulated for closed systems. The periodic cell exchanges mass momentum, angular momentum, and energy with the neighboring cells.\nWhen applied to the &lt;a href=\"microcanonical%20ensemble\"&gt;microcanonical ensemble&lt;/a&gt; (constant particle number, volume, and energy, abbreviated NVE), using PBC rather than reflecting walls slightly alters the sampling of the simulation due to the conservation of total linear momentum and the position of the center of mass; this ensemble has been termed the \"&lt;a href=\"molecular%20dynamics\"&gt;molecular dynamics&lt;/a&gt; ensemble\" or the NVEPG ensemble. These additional conserved quantities introduce minor artifacts related to the &lt;a href=\"statistical%20mechanics\"&gt;statistical mechanical&lt;/a&gt; definition of &lt;a href=\"temperature\"&gt;temperature&lt;/a&gt;, the departure of the velocity distributions from a &lt;a href=\"Boltzmann%20distribution\"&gt;Boltzmann distribution&lt;/a&gt;, and violations of equipartition for systems containing particles with heterogeneous &lt;a href=\"mass\"&gt;mass&lt;/a&gt;es. The simplest of these effects is that a system of \"N\" particles will behave, in the molecular dynamics ensemble, as a system of \"N-1\" particles. These artifacts have quantifiable consequences for small toy systems containing only perfectly hard particles; they have not been studied in depth for standard biomolecular simulations, but given the size of such systems, the effects will be largely negligible."
}